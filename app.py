import streamlit as st
from openai import OpenAI

# -------------------------------------------------
# í˜ì´ì§€ ì„¤ì •
# -------------------------------------------------
st.set_page_config(
    page_title="MajorPass",
    page_icon="ğŸ“",
    layout="centered"
)

# -------------------------------------------------
# CSS: ë¸”ë™ ë°°ê²½ + í™”ì´íŠ¸ ë„íŠ¸
# -------------------------------------------------
st.markdown("""
<style>
html, body, [data-testid="stApp"] {
    background-color: #0f0f0f;
    background-image: radial-gradient(#ffffff 0.6px, transparent 0.6px);
    background-size: 22px 22px;
    color: white;
}

h1, h2, h3, h4, h5, h6, p, div, label {
    color: white !important;
}

[data-testid="stSidebar"] {
    background-color: #111111;
}

.stSelectbox div, .stTextInput input, .stTextArea textarea {
    background-color: #1c1c1c;
    color: white;
}

.stButton button {
    background-color: white;
    color: black;
    font-weight: 600;
    border-radius: 8px;
}
</style>
""", unsafe_allow_html=True)

# -------------------------------------------------
# ì‚¬ì´ë“œë°”: API Key
# -------------------------------------------------
st.sidebar.title("ğŸ”‘ API ì„¤ì •")
api_key = st.sidebar.text_input("OpenAI API Key", type="password")

st.sidebar.markdown("---")
st.sidebar.markdown("**MajorPass**  \nì „ê³µì„ ì»¤ë¦¬ì–´ ìì‚°ìœ¼ë¡œ")

# -------------------------------------------------
# ì—°ì„¸ëŒ€í•™êµ ë³¸ìº í¼ìŠ¤ ë‹¨ê³¼ëŒ€ / í•™ê³¼ (í•™ë¶€)
# -------------------------------------------------
yonsei_colleges = {
    "ë¬¸ê³¼ëŒ€í•™": [
        "êµ­ì–´êµ­ë¬¸í•™ê³¼", "ì¤‘ì–´ì¤‘ë¬¸í•™ê³¼", "ì˜ì–´ì˜ë¬¸í•™ê³¼",
        "ë¶ˆì–´ë¶ˆë¬¸í•™ê³¼", "ë…ì–´ë…ë¬¸í•™ê³¼", "ì‚¬í•™ê³¼",
        "ì² í•™ê³¼", "ì‹¬ë¦¬í•™ê³¼"
    ],
    "ìƒê²½ëŒ€í•™": [
        "ê²½ì œí•™ë¶€", "ì‘ìš©í†µê³„í•™ê³¼"
    ],
    "ê²½ì˜ëŒ€í•™": [
        "ê²½ì˜í•™ê³¼"
    ],
    "ì´ê³¼ëŒ€í•™": [
        "ìˆ˜í•™ê³¼", "ë¬¼ë¦¬í•™ê³¼", "í™”í•™ê³¼",
        "ì§€êµ¬ì‹œìŠ¤í…œê³¼í•™ê³¼", "ì²œë¬¸ìš°ì£¼í•™ê³¼"
    ],
    "ê³µê³¼ëŒ€í•™": [
        "ê±´ì¶•ê³µí•™ê³¼", "ê±´ì„¤í™˜ê²½ê³µí•™ê³¼", "ê¸°ê³„ê³µí•™ë¶€",
        "ì „ê¸°ì „ìê³µí•™ë¶€", "ì‹ ì†Œì¬ê³µí•™ê³¼",
        "í™”ê³µìƒëª…ê³µí•™ê³¼", "ì‚°ì—…ê³µí•™ê³¼",
        "ì‹œìŠ¤í…œë°˜ë„ì²´ê³µí•™ê³¼"
    ],
    "ìƒëª…ì‹œìŠ¤í…œëŒ€í•™": [
        "ìƒëª…ê³µí•™ê³¼", "ì‹œìŠ¤í…œìƒë¬¼í•™ê³¼", "ìƒí™”í•™ê³¼"
    ],
    "ì‹ ê³¼ëŒ€í•™": [
        "ì‹ í•™ê³¼"
    ],
    "ì‚¬íšŒê³¼í•™ëŒ€í•™": [
        "ì •ì¹˜ì™¸êµí•™ê³¼", "í–‰ì •í•™ê³¼", "ì‚¬íšŒí•™ê³¼",
        "ì–¸ë¡ í™ë³´ì˜ìƒí•™ë¶€", "ë¬¸í—Œì •ë³´í•™ê³¼"
    ],
    "ìƒí™œê³¼í•™ëŒ€í•™": [
        "ì˜ë¥˜í™˜ê²½í•™ê³¼", "ì‹í’ˆì˜ì–‘í•™ê³¼", "ì‹¤ë‚´ê±´ì¶•í•™ê³¼",
        "ì•„ë™Â·ê°€ì¡±í•™ê³¼"
    ],
    "êµìœ¡ê³¼í•™ëŒ€í•™": [
        "êµìœ¡í•™ê³¼", "ì²´ìœ¡êµìœ¡í•™ê³¼"
    ],
    "ìŒì•…ëŒ€í•™": [
        "êµíšŒìŒì•…ê³¼", "ì„±ì•…ê³¼", "ì‘ê³¡ê³¼",
        "ê¸°ì•…ê³¼"
    ],
    "ê°„í˜¸ëŒ€í•™": [
        "ê°„í˜¸í•™ê³¼"
    ],
    "ì˜ê³¼ëŒ€í•™": [
        "ì˜ì˜ˆê³¼"
    ],
    "ì¹˜ê³¼ëŒ€í•™": [
        "ì¹˜ì˜ì˜ˆê³¼"
    ],
    "ì•½í•™ëŒ€í•™": [
        "ì•½í•™ê³¼"
    ],
    "ì–¸ë”ìš°ë“œêµ­ì œëŒ€í•™": [
        "UIC (êµ­ì œí•™ë¶€)"
    ]
}

# -------------------------------------------------
# ë©”ì¸ UI
# -------------------------------------------------
st.title("ğŸ“ MajorPass")
st.subheader("Path to Pass")
st.markdown("""
ì „ê³¼ë¥¼ í• ì§€,  
ë³µìˆ˜ì „ê³µì„ í• ì§€,  
í˜¹ì€ ì „ê³µì„ ìœ ì§€í•œ ì±„ ë‹¤ë¥¸ ì»¤ë¦¬ì–´ë¡œ ê°ˆì§€.

MajorPassëŠ” **ê²°ì •ì„ ëŒ€ì‹ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**  
ëŒ€ì‹ , **íŒë‹¨ ê¸°ì¤€ê³¼ ë‹¤ìŒ í–‰ë™**ì„ ì œê³µí•©ë‹ˆë‹¤.
""")

st.divider()

# -------------------------------------------------
# ì‚¬ìš©ì ì…ë ¥
# -------------------------------------------------
college = st.selectbox("ë‹¨ê³¼ëŒ€ ì„ íƒ (ì—°ì„¸ëŒ€ ë³¸ìº í¼ìŠ¤)", list(yonsei_colleges.keys()))
department = st.selectbox("ì „ê³µ ì„ íƒ", yonsei_colleges[college])

year = st.selectbox("í˜„ì¬ í•™ë…„", ["1í•™ë…„", "2í•™ë…„", "3í•™ë…„", "4í•™ë…„"])

career_goal = st.text_input(
    "í¬ë§ ì§„ë¡œ / ê´€ì‹¬ ë¶„ì•¼",
    placeholder="ì˜ˆ: ê´‘ê³ , ë¸Œëœë”©, UX, ì½˜í…ì¸  ê¸°íš"
)

concern = st.selectbox(
    "í˜„ì¬ ê°€ì¥ í° ê³ ë¯¼",
    ["ì „ê³¼", "ë³µìˆ˜ì „ê³µ", "ì „ê³µ ìœ ì§€", "ì§„ë¡œ ë¶ˆì•ˆ"]
)

anxiety = st.text_area(
    "ë¶ˆì•ˆí•˜ê±°ë‚˜ ê±±ì •ë˜ëŠ” ì ",
    placeholder="ì˜ˆ: ì „ê³µ í™œìš©ë„, ì·¨ì—… ê°€ëŠ¥ì„±, ì¡¸ì—… ì‹œê¸°"
)

# -------------------------------------------------
# OpenAI í•¨ìˆ˜ (ğŸ”¥ ìµœì‹  API)
# -------------------------------------------------
def get_majorpass_advice(info, api_key):
    client = OpenAI(api_key=api_key)

    prompt = f"""
ë‹¹ì‹ ì€ ëŒ€í•™ìƒ ì§„ë¡œ ìƒë‹´ ì „ë¬¸ AI ì½”ì¹˜ì…ë‹ˆë‹¤.
ëª©í‘œëŠ” ì „ê³µì„ í¬ê¸°í•˜ê²Œ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,
ì „ê³µì„ ì»¤ë¦¬ì–´ ìì‚°ìœ¼ë¡œ ì¬í•´ì„í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

[ì‚¬ìš©ì ì •ë³´]
- í•™êµ: ì—°ì„¸ëŒ€í•™êµ ë³¸ìº í¼ìŠ¤
- ë‹¨ê³¼ëŒ€: {info['college']}
- ì „ê³µ: {info['department']}
- í•™ë…„: {info['year']}
- í¬ë§ ì§„ë¡œ: {info['career']}
- ê³ ë¯¼ ìœ í˜•: {info['concern']}
- ë¶ˆì•ˆ ìš”ì†Œ: {info['anxiety']}

ìˆœì„œ:
1. ìƒí™© ìš”ì•½ ë° ê³µê°
2. í˜„ì¬ ì „ê³µì—ì„œ ì¶•ì ëœ ì—­ëŸ‰
3. í¬ë§ ì§„ë¡œ ê´€ì ì—ì„œì˜ ì—°ê²° ê°€ëŠ¥ì„±
4. ì „ê³¼ / ë³µìˆ˜ì „ê³µ / ìœ ì§€ ë¹„êµ
5. ì „ê³µì„ ì»¤ë¦¬ì–´ ìì‚°ìœ¼ë¡œ ì“°ëŠ” ì „ëµ
6. ì§€ê¸ˆ ë‹¹ì¥ í•  ìˆ˜ ìˆëŠ” To-do
"""

    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": "ë„ˆëŠ” í˜„ì‹¤ì ì´ê³  ê³µê° ëŠ¥ë ¥ì´ ë†’ì€ ì§„ë¡œ ì½”ì¹˜ë‹¤."},
            {"role": "user", "content": prompt}
        ],
        temperature=0.7
    )

    return response.choices[0].message.content

# -------------------------------------------------
# ì‹¤í–‰
# -------------------------------------------------
if st.button("ğŸš€ MajorPass ë¶„ì„ ì‹œì‘"):
    if not api_key:
        st.warning("ì‚¬ì´ë“œë°”ì— OpenAI API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    elif not career_goal:
        st.warning("í¬ë§ ì§„ë¡œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    else:
        with st.spinner("ì „ê³µì„ ì»¤ë¦¬ì–´ ìì‚°ìœ¼ë¡œ ë¶„ì„ ì¤‘..."):
            result = get_majorpass_advice({
                "college": college,
                "department": department,
                "year": year,
                "career": career_goal,
                "concern": concern,
                "anxiety": anxiety
            }, api_key)

        st.divider()
        st.header("ğŸ“Š ë¶„ì„ ê²°ê³¼")
        st.markdown(result)
        st.success("ê²°ì •ì€ ë‹¹ì‹ ì˜ ëª«ì…ë‹ˆë‹¤. MajorPassëŠ” ê¸°ì¤€ì„ ì œê³µí•©ë‹ˆë‹¤.")





